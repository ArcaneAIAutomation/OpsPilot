{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "notifier.email configuration",
  "type": "object",
  "properties": {
    "enabled": {
      "type": "boolean",
      "default": true
    },
    "transport": {
      "type": "string",
      "enum": ["oauth", "smtp"],
      "default": "oauth",
      "description": "Email transport: 'oauth' (Gmail / Microsoft Graph API) or 'smtp' (legacy)."
    },
    "oauth": {
      "type": "object",
      "description": "OAuth 2.0 configuration (used when transport = 'oauth').",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["google", "microsoft"],
          "default": "google",
          "description": "OAuth provider: 'google' (Gmail API) or 'microsoft' (Graph API)."
        },
        "clientId": {
          "type": "string",
          "default": "",
          "description": "OAuth 2.0 Client ID. Env: OPSPILOT_EMAIL_CLIENT_ID"
        },
        "clientSecret": {
          "type": "string",
          "default": "",
          "description": "OAuth 2.0 Client Secret. Env: OPSPILOT_EMAIL_CLIENT_SECRET"
        },
        "refreshToken": {
          "type": "string",
          "default": "",
          "description": "OAuth 2.0 Refresh Token. Env: OPSPILOT_EMAIL_REFRESH_TOKEN"
        },
        "tenantId": {
          "type": "string",
          "default": "common",
          "description": "Microsoft Azure AD Tenant ID (Microsoft only)."
        },
        "userId": {
          "type": "string",
          "default": "",
          "description": "Microsoft Graph: send as specific user (e.g. user@domain.com). Leave empty for /me."
        }
      },
      "additionalProperties": false
    },
    "smtpHost": {
      "type": "string",
      "default": "",
      "description": "SMTP server hostname (used when transport = 'smtp')."
    },
    "smtpPort": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "default": 587,
      "description": "SMTP server port (587 for STARTTLS, 465 for SSL, 25 for plain)."
    },
    "secure": {
      "type": "boolean",
      "default": false,
      "description": "Use implicit TLS (port 465). For STARTTLS on 587, keep false."
    },
    "username": {
      "type": "string",
      "default": "",
      "description": "SMTP authentication username."
    },
    "password": {
      "type": "string",
      "default": "",
      "description": "SMTP authentication password."
    },
    "from": {
      "type": "string",
      "description": "Sender email address.",
      "default": "opspilot@localhost"
    },
    "to": {
      "type": "array",
      "items": { "type": "string", "format": "email" },
      "description": "Recipient email addresses.",
      "default": []
    },
    "subjectPrefix": {
      "type": "string",
      "default": "[OpsPilot]",
      "description": "Prefix prepended to all email subjects."
    },
    "events": {
      "type": "array",
      "items": { "type": "string" },
      "default": ["incident.created", "action.proposed", "action.executed", "enrichment.completed"],
      "description": "Event types to send emails for."
    },
    "minSeverity": {
      "type": "string",
      "enum": ["info", "warning", "critical"],
      "default": "warning",
      "description": "Minimum severity for incident events."
    },
    "rateLimitPerMinute": {
      "type": "integer",
      "minimum": 1,
      "maximum": 1000,
      "default": 10,
      "description": "Max emails sent per minute."
    },
    "timeoutMs": {
      "type": "integer",
      "minimum": 1000,
      "default": 30000,
      "description": "Request timeout in milliseconds."
    }
  },
  "required": ["to"],
  "additionalProperties": false
}
